<!DOCTYPE html>
<!-- Generated by pkgdown + https://github.com/insightsengineering/r-pkgdown-multiversion -->
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Understanding `tern` functions • tern</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Understanding `tern` functions">
<link rel="stylesheet" href="../consent.css">
<script src="../consent.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tern</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.9.7</small>

    <div style="width: 140px; margin-left: 0.5rem;"> <small class="nav-text text-muted me-auto">part of</small> <img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/nest.png?raw=true" alt="NEST" style="height: 30px;"><a href="https://pharmaverse.org/" class="external-link"><img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/pharmaverse.png?raw=true" alt="pharmaverse" style="height: 28px;"></a> </div>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/tern.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/missing_values.html">Missing Values in Tern</a></li>
    <li><a class="dropdown-item" href="../articles/tables.html">Tabulation</a></li>
    <li><a class="dropdown-item" href="../articles/tern_formats.html">Formatting Functions</a></li>
    <li><a class="dropdown-item" href="../articles/tern_functions_guide.html">Understanding `tern` functions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reports" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reports</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reports">
<li><a class="dropdown-item" href="../coverage-report/">Coverage report</a></li>
    <li><a class="dropdown-item" href="../unit-test-report/">Unit test report</a></li>
    <li><a class="dropdown-item" href="../unit-test-report-non-cran/">Non-CRAN unit test report</a></li>
  </ul>
</li>
      <div><li class="nav-item dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-versions">Versions</a>
    <div class="dropdown-menu" aria-labelledby="dropdown-versions">
    <a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/release-candidate">release-candidate</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/main">main</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/latest-tag">latest-tag</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/v0.9.7">v0.9.7</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/v0.9.6">v0.9.6</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/v0.9.5">v0.9.5</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/v0.9.4">v0.9.4</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/v0.9.3">v0.9.3</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/v0.9.2">v0.9.2</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/v0.9.2-rc1">v0.9.2-rc1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/v0.9.1">v0.9.1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/v0.9.1-rc3">v0.9.1-rc3</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/v0.9.0">v0.9.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/v0.8.5">v0.8.5</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/v0.8.5-rc2">v0.8.5-rc2</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/v0.8.5-rc1">v0.8.5-rc1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/v0.8.4">v0.8.4</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/v0.8.4-rc1">v0.8.4-rc1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/v0.8.3-rc2">v0.8.3-rc2</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/v0.8.3-rc1">v0.8.3-rc1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/v0.8.2">v0.8.2</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/v0.8.2-rc2">v0.8.2-rc2</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/v0.8.2-rc1">v0.8.2-rc1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/v0.8.1">v0.8.1</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/v0.8.0">v0.8.0</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/v0.7.10">v0.7.10</a>
<a class="dropdown-item" data-toggle="tooltip" title="" href="https://insightsengineering.github.io/tern/v0.7.9">v0.7.9</a>
</div>
</li></div>
</ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/insightsengineering/tern" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Understanding `tern` functions</h1>
            
            <h4 data-toc-skip class="date">2024-11-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/insightsengineering/tern/blob/main/vignettes/tern_functions_guide.Rmd" class="external-link"><code>vignettes/tern_functions_guide.Rmd</code></a></small>
      <div class="d-none name"><code>tern_functions_guide.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="understanding-tern-functions">Understanding <code>tern</code> functions<a class="anchor" aria-label="anchor" href="#understanding-tern-functions"></a>
</h2>
<p>Every function in the <code>tern</code> package is designed to have a
certain structure that can cooperate well with every user’s need, while
maintaining a consistent and predictable behavior. This document will
guide you through an example function in the package, explaining the
purpose of many of its building blocks and how they can be used.</p>
<p>As we recently worked on it we will consider
<code><a href="../reference/summarize_change.html">summarize_change()</a></code> as an example. This function is used to
calculate the change from a baseline value for a given variable. A
realistic example can be found in <a href="https://insightsengineering.github.io/tlg-catalog/stable/tables/lab-results/lbt03.html" class="external-link"><code>LBT03</code></a>
from the TLG-catalog.</p>
<p><code><a href="../reference/summarize_change.html">summarize_change()</a></code> is the main function that is
available to the user. You can find lists of these functions in
<code><a href="../reference/analyze_functions.html">?tern::analyze_functions</a></code>. All of these are build around
<code><a href="https://insightsengineering.github.io/rtables/latest-release/reference/analyze.html" class="external-link">rtables::analyze()</a></code> function, which is the core analysis
function in <code>rtables</code>. All these wrapper functions call
specific analysis functions (always written as <code>a_*</code>) that
are meant to handle the statistic functions (always written as
<code>s_*</code>) and format the results with the
<code>rtables::in_row()</code> function. We can summarize this structure
as follows:</p>
<p><code><a href="../reference/summarize_change.html">summarize_change()</a></code> (1)-&gt;
<code><a href="../reference/summarize_change.html">a_change_from_baseline()</a></code> (2)-&gt;
[<code><a href="../reference/summarize_change.html">s_change_from_baseline()</a></code> +
<code>rtables::in_row()</code>]</p>
<p>The main questions that may arise are:</p>
<ol style="list-style-type: decimal">
<li>Handling of <code>NA</code>.</li>
<li>Handling of formats.</li>
<li>Additional statistics.</li>
</ol>
<p>Data set and library loading.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://insightsengineering.github.io/tern/">tern</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: rtables</span></span>
<span><span class="co">#&gt; Loading required package: formatters</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'formatters'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     %||%</span></span>
<span><span class="co">#&gt; Loading required package: magrittr</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'rtables'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:utils':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     str</span></span>
<span><span class="co">#&gt; Registered S3 method overwritten by 'tern':</span></span>
<span><span class="co">#&gt;   method   from </span></span>
<span><span class="co">#&gt;   tidy.glm broom</span></span>
<span></span>
<span><span class="co">## Fabricate dataset</span></span>
<span><span class="va">dta_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  USUBJID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>  AVISIT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"V"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, <span class="fl">6</span><span class="op">)</span>,</span>
<span>  ARM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  AVAL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">9</span><span class="op">:</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ABLFLL <span class="op">=</span> <span class="va">AVISIT</span> <span class="op">==</span> <span class="st">"V1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">USUBJID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    BLVAL <span class="op">=</span> <span class="va">AVAL</span><span class="op">[</span><span class="va">ABLFLL</span><span class="op">]</span>,</span>
<span>    CHG <span class="op">=</span> <span class="va">AVAL</span> <span class="op">-</span> <span class="va">BLVAL</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Classic use of <code><a href="../reference/summarize_change.html">summarize_change()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fix_layout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://insightsengineering.github.io/rtables/latest-release/reference/basic_table.html" class="external-link">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://insightsengineering.github.io/rtables/latest-release/reference/split_cols_by.html" class="external-link">split_cols_by</a></span><span class="op">(</span><span class="st">"ARM"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://insightsengineering.github.io/rtables/latest-release/reference/split_rows_by.html" class="external-link">split_rows_by</a></span><span class="op">(</span><span class="st">"AVISIT"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Dealing with NAs: na_rm = TRUE</span></span>
<span><span class="va">fix_layout</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/summarize_change.html">summarize_change</a></span><span class="op">(</span><span class="st">"CHG"</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>value <span class="op">=</span> <span class="st">"AVAL"</span>, baseline_flag <span class="op">=</span> <span class="st">"ABLFLL"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://insightsengineering.github.io/rtables/latest-release/reference/build_table.html" class="external-link">build_table</a></span><span class="op">(</span><span class="va">dta_test</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                     A               B         C </span></span>
<span><span class="co">#&gt; ————————————————————————————————————————————————</span></span>
<span><span class="co">#&gt; V1                                              </span></span>
<span><span class="co">#&gt;   n                 2               1         0 </span></span>
<span><span class="co">#&gt;   Mean (SD)    7.50 (2.12)      3.00 (NA)     NA</span></span>
<span><span class="co">#&gt;   Median          7.50            3.00        NA</span></span>
<span><span class="co">#&gt;   Min - Max    6.00 - 9.00     3.00 - 3.00    NA</span></span>
<span><span class="co">#&gt; V2                                              </span></span>
<span><span class="co">#&gt;   n                 2               1         0 </span></span>
<span><span class="co">#&gt;   Mean (SD)   -1.00 (0.00)     -1.00 (NA)     NA</span></span>
<span><span class="co">#&gt;   Median          -1.00           -1.00       NA</span></span>
<span><span class="co">#&gt;   Min - Max   -1.00 - -1.00   -1.00 - -1.00   NA</span></span>
<span><span class="co">#&gt; V3                                              </span></span>
<span><span class="co">#&gt;   n                 2               1         0 </span></span>
<span><span class="co">#&gt;   Mean (SD)   -2.00 (0.00)     -2.00 (NA)     NA</span></span>
<span><span class="co">#&gt;   Median          -2.00           -2.00       NA</span></span>
<span><span class="co">#&gt;   Min - Max   -2.00 - -2.00   -2.00 - -2.00   NA</span></span>
<span></span>
<span><span class="co"># Dealing with NAs: na_rm = FALSE</span></span>
<span><span class="va">fix_layout</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/summarize_change.html">summarize_change</a></span><span class="op">(</span><span class="st">"CHG"</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>value <span class="op">=</span> <span class="st">"AVAL"</span>, baseline_flag <span class="op">=</span> <span class="st">"ABLFLL"</span><span class="op">)</span>, na_rm <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://insightsengineering.github.io/rtables/latest-release/reference/build_table.html" class="external-link">build_table</a></span><span class="op">(</span><span class="va">dta_test</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                     A               B         C </span></span>
<span><span class="co">#&gt; ————————————————————————————————————————————————</span></span>
<span><span class="co">#&gt; V1                                              </span></span>
<span><span class="co">#&gt;   n                 2               1         0 </span></span>
<span><span class="co">#&gt;   Mean (SD)    7.50 (2.12)      3.00 (NA)     NA</span></span>
<span><span class="co">#&gt;   Median          7.50            3.00        NA</span></span>
<span><span class="co">#&gt;   Min - Max    6.00 - 9.00     3.00 - 3.00    NA</span></span>
<span><span class="co">#&gt; V2                                              </span></span>
<span><span class="co">#&gt;   n                 2               1         0 </span></span>
<span><span class="co">#&gt;   Mean (SD)   -1.00 (0.00)     -1.00 (NA)     NA</span></span>
<span><span class="co">#&gt;   Median          -1.00           -1.00       NA</span></span>
<span><span class="co">#&gt;   Min - Max   -1.00 - -1.00   -1.00 - -1.00   NA</span></span>
<span><span class="co">#&gt; V3                                              </span></span>
<span><span class="co">#&gt;   n                 2               1         0 </span></span>
<span><span class="co">#&gt;   Mean (SD)   -2.00 (0.00)     -2.00 (NA)     NA</span></span>
<span><span class="co">#&gt;   Median          -2.00           -2.00       NA</span></span>
<span><span class="co">#&gt;   Min - Max   -2.00 - -2.00   -2.00 - -2.00   NA</span></span>
<span></span>
<span><span class="co"># changing the NA string (it is done on all levels)</span></span>
<span><span class="va">fix_layout</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/summarize_change.html">summarize_change</a></span><span class="op">(</span><span class="st">"CHG"</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>value <span class="op">=</span> <span class="st">"AVAL"</span>, baseline_flag <span class="op">=</span> <span class="st">"ABLFLL"</span><span class="op">)</span>, na_str <span class="op">=</span> <span class="st">"my_na"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://insightsengineering.github.io/rtables/latest-release/reference/build_table.html" class="external-link">build_table</a></span><span class="op">(</span><span class="va">dta_test</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                     A               B           C  </span></span>
<span><span class="co">#&gt; ———————————————————————————————————————————————————</span></span>
<span><span class="co">#&gt; V1                                                 </span></span>
<span><span class="co">#&gt;   n                 2               1           0  </span></span>
<span><span class="co">#&gt;   Mean (SD)    7.50 (2.12)    3.00 (my_na)    my_na</span></span>
<span><span class="co">#&gt;   Median          7.50            3.00        my_na</span></span>
<span><span class="co">#&gt;   Min - Max    6.00 - 9.00     3.00 - 3.00    my_na</span></span>
<span><span class="co">#&gt; V2                                                 </span></span>
<span><span class="co">#&gt;   n                 2               1           0  </span></span>
<span><span class="co">#&gt;   Mean (SD)   -1.00 (0.00)    -1.00 (my_na)   my_na</span></span>
<span><span class="co">#&gt;   Median          -1.00           -1.00       my_na</span></span>
<span><span class="co">#&gt;   Min - Max   -1.00 - -1.00   -1.00 - -1.00   my_na</span></span>
<span><span class="co">#&gt; V3                                                 </span></span>
<span><span class="co">#&gt;   n                 2               1           0  </span></span>
<span><span class="co">#&gt;   Mean (SD)   -2.00 (0.00)    -2.00 (my_na)   my_na</span></span>
<span><span class="co">#&gt;   Median          -2.00           -2.00       my_na</span></span>
<span><span class="co">#&gt;   Min - Max   -2.00 - -2.00   -2.00 - -2.00   my_na</span></span></code></pre></div>
<p><code>.formats</code>, <code>.labels</code>, and
<code>.indent_mods</code> depend on the names of <code>.stats</code>.
Here is how you can change the default formatting.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># changing n count format and label and indentation</span></span>
<span><span class="va">fix_layout</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/summarize_change.html">summarize_change</a></span><span class="op">(</span><span class="st">"CHG"</span>,</span>
<span>    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>value <span class="op">=</span> <span class="st">"AVAL"</span>, baseline_flag <span class="op">=</span> <span class="st">"ABLFLL"</span><span class="op">)</span>,</span>
<span>    .stats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="st">"mean"</span><span class="op">)</span>, <span class="co"># reducing the number of stats for visual appreciation</span></span>
<span>    .formats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>n <span class="op">=</span> <span class="st">"xx.xx"</span><span class="op">)</span>,</span>
<span>    .labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>n <span class="op">=</span> <span class="st">"NnNn"</span><span class="op">)</span>,</span>
<span>    .indent_mods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, na_str <span class="op">=</span> <span class="st">"nA"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://insightsengineering.github.io/rtables/latest-release/reference/build_table.html" class="external-link">build_table</a></span><span class="op">(</span><span class="va">dta_test</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;                     A      B      C  </span></span>
<span><span class="co">#&gt; —————————————————————————————————————</span></span>
<span><span class="co">#&gt; V1                                   </span></span>
<span><span class="co">#&gt;             NnNn   2.00   1.00   0.00</span></span>
<span><span class="co">#&gt;   Mean             7.5    3.0     nA </span></span>
<span><span class="co">#&gt; V2                                   </span></span>
<span><span class="co">#&gt;             NnNn   2.00   1.00   0.00</span></span>
<span><span class="co">#&gt;   Mean             -1.0   -1.0    nA </span></span>
<span><span class="co">#&gt; V3                                   </span></span>
<span><span class="co">#&gt;             NnNn   2.00   1.00   0.00</span></span>
<span><span class="co">#&gt;   Mean             -2.0   -2.0    nA</span></span></code></pre></div>
<p>What if I want something special for the format?</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># changing n count format and label and indentation</span></span>
<span><span class="va">fix_layout</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/summarize_change.html">summarize_change</a></span><span class="op">(</span><span class="st">"CHG"</span>,</span>
<span>    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>value <span class="op">=</span> <span class="st">"AVAL"</span>, baseline_flag <span class="op">=</span> <span class="st">"ABLFLL"</span><span class="op">)</span>,</span>
<span>    .stats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="st">"mean"</span><span class="op">)</span>, <span class="co"># reducing the number of stats for visual appreciation</span></span>
<span>    .formats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>n <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">x</span> <span class="op">*</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Note you need ...!!!</span></span>
<span>  <span class="fu"><a href="https://insightsengineering.github.io/rtables/latest-release/reference/build_table.html" class="external-link">build_table</a></span><span class="op">(</span><span class="va">dta_test</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;           A      B     C </span></span>
<span><span class="co">#&gt; —————————————————————————</span></span>
<span><span class="co">#&gt; V1                       </span></span>
<span><span class="co">#&gt;   n      200    100    0 </span></span>
<span><span class="co">#&gt;   Mean   7.5    3.0    NA</span></span>
<span><span class="co">#&gt; V2                       </span></span>
<span><span class="co">#&gt;   n      200    100    0 </span></span>
<span><span class="co">#&gt;   Mean   -1.0   -1.0   NA</span></span>
<span><span class="co">#&gt; V3                       </span></span>
<span><span class="co">#&gt;   n      200    100    0 </span></span>
<span><span class="co">#&gt;   Mean   -2.0   -2.0   NA</span></span></code></pre></div>
<p>Adding a custom statistic (and custom format):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># changing n count format and label and indentation</span></span>
<span><span class="va">fix_layout</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/summarize_change.html">summarize_change</a></span><span class="op">(</span></span>
<span>    <span class="st">"CHG"</span>,</span>
<span>    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>value <span class="op">=</span> <span class="st">"AVAL"</span>, baseline_flag <span class="op">=</span> <span class="st">"ABLFLL"</span><span class="op">)</span>,</span>
<span>    .stats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"n"</span>, <span class="st">"my_stat"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">AVAL</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>      <span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">$</span><span class="va">.N_row</span> <span class="co"># It has access at all `?rtables::additional_fun_params`</span></span>
<span>      <span class="va">a</span> <span class="op">/</span> <span class="va">b</span></span>
<span>    <span class="op">}</span><span class="op">)</span>,</span>
<span>    .formats <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"my_stat"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://insightsengineering.github.io/rtables/latest-release/reference/build_table.html" class="external-link">build_table</a></span><span class="op">(</span><span class="va">dta_test</span><span class="op">)</span></span>
<span><span class="co">#&gt;              A      B     C </span></span>
<span><span class="co">#&gt; ————————————————————————————</span></span>
<span><span class="co">#&gt; V1                          </span></span>
<span><span class="co">#&gt;   n          2      1     0 </span></span>
<span><span class="co">#&gt;   my_stat   1.25   0.50   NA</span></span>
<span><span class="co">#&gt; V2                          </span></span>
<span><span class="co">#&gt;   n          2      1     0 </span></span>
<span><span class="co">#&gt;   my_stat   1.08   0.33   NA</span></span>
<span><span class="co">#&gt; V3                          </span></span>
<span><span class="co">#&gt;   n          2      1     0 </span></span>
<span><span class="co">#&gt;   my_stat   0.92   0.17   NA</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="for-developers">For Developers<a class="anchor" aria-label="anchor" href="#for-developers"></a>
</h2>
<p>In all of these layers there are specific parameters that need to be
available, and, while <code>rtables</code> has multiple way to handle
formatting and <code>NA</code> values, we had to decide how to correctly
handle these and additional extra arguments. We follow the following
scheme:</p>
<p>Level 1: <code><a href="../reference/summarize_change.html">summarize_change()</a></code>: all parameters without a
starting dot <code>.*</code> are used or added to
<code>extra_args</code>. Specifically, here we solve <code>NA</code>
values by using <code>inclNAs = TRUE</code> always in
<code><a href="https://insightsengineering.github.io/rtables/latest-release/reference/analyze.html" class="external-link">rtables::analyze()</a></code>. This will keep <code>NA</code> values
to the analysis function <code>a_*</code>. Please follow the way
<code>na_rm</code> is used in <code>summarize_change</code>, and you
will see how to retrieve it from <code>...</code> only when you need it.
In this case, only at the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> level.
<code>na_str</code>, instead is set only on the top level (in the
<code><a href="https://insightsengineering.github.io/rtables/latest-release/reference/analyze.html" class="external-link">rtables::analyze()</a></code> call). We may want to be
statistic-dependent in the future, but we still need to think how to
accomplish that. We add the <code><a href="https://insightsengineering.github.io/rtables/latest-release/reference/additional_fun_params.html" class="external-link">rtables::additional_fun_params</a></code>
to the analysis function so to make them available as <code>...</code>
in the next level. Note that they all can be retrieved with
<code>list(...)[["na_rm"]]</code>.</p>
<p>Level 2: <code><a href="../reference/summarize_change.html">a_change_from_baseline()</a></code>: all parameters
starting with a dot <code>.</code> are ideally used or transmitted into
lower functions from here. Mainly <code>.stats</code>,
<code>.formats</code>, <code>.labels</code>, and
<code>.indent_mods</code> are used only at this level. We also bring
forward <code>extra_afun_params</code> to the <code>...</code> list for
the statistical function. Notice the handling for additional parameters
in the <code><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call()</a></code> function.</p>
<p>Level 3 and beyond: <code>s_*</code> functions. In this case
<code>s_summary</code> is at the end used and the result brought into
the main <code>a_*</code> function.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="nest">
  <p>tern is a part of the <strong>NEST</strong> and <a href="https://pharmaverse.org/" class="external-link"><strong>pharmaverse</strong></a>.</p>
</div>
<script type="text/javascript" src="../analytics.js"></script></footer>
</div>





  </body>
</html>
