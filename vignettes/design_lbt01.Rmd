---
title: "Design: Laboratory Test Results and Change from Baseline by Visit (LBT01)"
author: "Saibah Chohan"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 2
    number_sections: true
    theme: journal
    highlight: zenburn
vignette: >
  %\VignetteIndexEntry{design_lbt01}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
bibliography: ../inst/ref/references.bib

---
Configuration
=============

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  dev = "svg"
)
```

```{r setup}
library(rtables)
packageVersion("rtables")
```

### Functions 

#### `summarize_colvars`

`extra_args` is now available for `analyze_colvars` so can pass the additional arguments
to `s_summary` or the respective analysis function, respectively.

```{r}
library(tern)
summarize_colvars

```


#### Tests

```{r test_summarize_colvars}
# Fabricated dataset.
set.seed(5)
dta_test <- data.frame(
  USUBJID = rep(1:6, each = 3),
  PARAMCD = rep("lab", 6*3),
  AVISIT  = rep(paste0("V", 1:3), 6),
  ARM     = rep(LETTERS[1:3], rep(6, 3)),
  AVAL    = round(rnorm(3*6), 2),
  CHG     = round(rnorm(3*6), 2)
)
result <- basic_table() %>% 
  split_cols_by("ARM") %>%
  add_colcounts() %>%
  split_rows_by("AVISIT") %>% 
  split_cols_by_multivar(
    vars = c("AVAL", "CHG"),
    varlabels = c("Analysis Value", "Absolute Change from Baseline")
  ) %>% 
  summarize_colvars() %>% 
  build_table(df = dta_test)
result
```

At this point I don't know where the warning "longer argument not a multiple of length of shorter"
is coming from. It seems to be rtables internal. Filed at https://github.com/Roche/rtables/issues/76 

Notes: `summarize_colvars` does not need a vars argument since var names are inherited from `[rtables::split_cols_by_multivar()]`. 

Also note that we cannot yet have column number totals in the `ARM` top split, but only get the duplicate 
column numbers below the analysis columns.

#### Modified output

```{r application_02}
result <- basic_table() %>% 
  split_cols_by("ARM") %>%
  add_colcounts() %>%
  split_rows_by("AVISIT") %>% 
  split_cols_by_multivar(
    vars = c("AVAL", "CHG"),
    varlabels = c("Analysis Value", "Absolute Change from Baseline")
  ) %>% 
  summarize_colvars(
    .labels = c(range = "Range")
  ) %>% 
  build_table(df = dta_test)
result
```

Note:
- Add this point we cannot easily remove cell contents of the intersection of a "Baseline" visit 
  and the "Change from Baseline" column. 
- Alternative concepts such as similar to `summarize_change` are theoretically possible but 
  would not be elegant here since the two columns should be handled in parallel when using
  `analyze_colvars`.
